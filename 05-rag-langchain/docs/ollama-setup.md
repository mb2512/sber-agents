# Установка и настройка Ollama для сравнения моделей эмбеддингов

## Шаг 1: Установка Ollama

### Для Windows:

1. Перейдите на официальный сайт: https://ollama.ai/download
2. Скачайте установщик для Windows
3. Запустите установщик и следуйте инструкциям
4. После установки Ollama должен автоматически запуститься как служба

### Проверка установки:

```bash
ollama --version
```

Если команда не найдена, убедитесь, что Ollama добавлен в PATH или перезапустите терминал.

## Шаг 2: Скачивание модели эмбеддингов

```bash
ollama pull aroxima/multilingual-e5-large-instruct:latest
```

Это может занять некоторое время, так как модель довольно большая (~2-3 GB).

### Проверка, что модель скачана:

```bash
ollama list
```

Должна появиться строка: `aroxima/multilingual-e5-large-instruct:latest`

## Шаг 3: Настройка .env

Откройте файл `.env` и измените `EMBEDDING_MODEL`:

```bash
# Для использования Ollama модели
EMBEDDING_MODEL=aroxima/multilingual-e5-large-instruct:latest

# Для использования Fireworks (вернуться обратно)
# EMBEDDING_MODEL=accounts/fireworks/models/qwen3-embedding-8b
```

**Важно:** При использовании Ollama не нужны `OPENAI_API_KEY` и `OPENAI_BASE_URL` для эмбеддингов, но они всё ещё нужны для основной LLM модели.

## Шаг 4: Переиндексация документов

После изменения модели эмбеддингов необходимо переиндексировать документы:

1. Перезапустите бота
2. Или используйте команду `/index` в Telegram

## Сравнение моделей

### Fireworks (qwen3-embedding-8b):
- ✅ Быстрая индексация (API)
- ✅ Не требует локальных ресурсов
- ✅ Хорошее качество для русскоязычных текстов
- ❌ Требует API ключ
- ❌ Зависит от интернет-соединения

### Ollama (aroxima/multilingual-e5-large-instruct):
- ✅ Работает локально (без интернета)
- ✅ Не требует API ключа
- ✅ Multilingual модель (поддержка многих языков)
- ❌ Требует локальных ресурсов (RAM, диск)
- ❌ Медленнее при первой индексации

## Устранение проблем

### Ollama не запускается:
```bash
# Проверьте, что служба Ollama запущена
# В Windows: откройте "Службы" и найдите Ollama
```

### Модель не скачивается:
```bash
# Проверьте интернет-соединение
# Попробуйте снова:
ollama pull aroxima/multilingual-e5-large-instruct:latest
```

### Ошибка при индексации:
- Убедитесь, что Ollama запущен: `ollama list` должен работать
- Проверьте, что модель скачана: `ollama list | grep multilingual-e5`
- Проверьте логи бота на наличие ошибок

