# Отчёт о выполнении задания: AI-driven разработка Telegram-бота

## Название проекта и краткое описание

**AIDD Bot** — минимальный Telegram-бот с интеграцией LLM, выступающий в роли путешественника-гида. Бот ведёт диалоги с пользователями, отвечает на вопросы о туристических местах, маршрутах и даёт практические советы путешественникам. Реализован как MVP (минимально жизнеспособный прототип) с использованием AI-driven разработки.

## Выбранная роль ИИ-ассистента и её обоснование

**Роль: Путешественник-гид**

Обоснование:
- Универсальность и практичность: роль применима к широкому спектру вопросов о путешествиях
- Чёткая направленность ответов: позволяет структурировать информацию о локациях, маршрутах и бюджете
- Бизнес-ценность: решает реальную задачу пользователей, ищущих практическую информацию о туризме
- Техническая простота: не требует сложной интеграции с внешними API, работает на основе LLM-реакции

Системный промпт, определяющий роль:
> "Ты — Путешественник-гид. Отвечай кратко, практично, по делу. Помогай с маршрутами, локациями, логистикой, бюджетом и советами путешественника. Пиши по-русски, структурируй списками, избегай воды."

## Реализованные возможности

- [x] **Базовый Telegram-бот**
  - Запуск через polling метод
  - Обработка команды `/start` с приветственным сообщением
  - Обработка команды `/ping` для проверки работоспособности

- [x] **Интеграция с LLM через OpenRouter**
  - Подключение к OpenAI-совместимому API через OpenRouter
  - Поддержка множественных бесплатных моделей с автоматическим fallback
  - Обработка ошибок недостатка кредитов и сетевых сбоев

- [x] **Роль "Путешественник-гид"**
  - Настройка системного промпта для задания контекста и поведения
  - Генерация структурированных ответов на вопросы пользователей
  - Ограничение длины ответов (max_tokens=400)

- [x] **Конфигурирование через файл и переменные окружения**
  - Загрузка настроек из `config.toml`
  - Поддержка переменных окружения для токенов и параметров
  - Настройка модели LLM через конфигурацию

- [x] **Логирование**
  - Ротация логов в файл `logs/app.log`
  - Настраиваемый уровень логирования через `LOG_LEVEL`
  - Сохранение запросов пользователей и ошибок

- [x] **Устойчивость к сбоям**
  - Автоматические повторы при сетевых ошибках
  - Fallback между различными моделями LLM
  - Graceful handling ошибок отправки сообщений в Telegram

## Технологический стек

| Компонент | Технология | Версия/Описание |
|-----------|-----------|-----------------|
| Язык программирования | Python | >=3.10,<3.13 |
| Управление зависимостями | uv | Современный менеджер пакетов |
| Telegram Bot API | aiogram | 3.13.1 |
| HTTP-клиент | aiohttp | 3.9.5 |
| LLM-клиент | openai | >=1.47.0,<2 |
| Провайдер LLM | OpenRouter | Свободный доступ к множественным моделям |
| Конфигурация | TOML | config.toml |
| Автоматизация | Make | Makefile для сборки и запуска |
| Сборка | setuptools | Python build backend |

## Инструменты AI-driven разработки

### Используемая AI-coding IDE
- **Cursor IDE** — AI-powered редактор кода с интеграцией LLM

### Используемые LLM модели
- Для генерации кода и документации: модель, интегрированная в Cursor IDE
- Для работы бота (runtime): подключаемые через OpenRouter модели:
  - `meta-llama/llama-3.1-8b-instruct:free`
  - `mistralai/mistral-7b-instruct:free`
  - `google/gemma-2-9b-it:free`
  - `qwen/qwen-2-7b-instruct:free`
  - `openrouter/auto`

## Скриншот работы

![Работа бота в Telegram](screenshot_telegram.png)

На скриншоте видна работа бота:
1. Пользователь отправляет `/start` — бот приветствует
2. Пользователь отправляет `/ping` — бот отвечает "pong"
3. Пользователь спрашивает "Расскажи куда съездить в Екатеринбурге?"
4. Бот генерирует подробный структурированный ответ с категориями достопримечательностей, храмов, музеев и т.д.

*Примечание: скриншот был предоставлен в процессе выполнения задания*

## Процесс разработки: основные вызовы и решения

### Вызов 1: Выбор LLM-провайдера
**Проблема:** Необходимо выбрать бесплатный и надёжный способ доступа к LLM для прототипа

**Решение:** 
- Выбран OpenRouter как агрегатор множественных моделей
- Реализован механизм автоматического переключения между бесплатными моделями при недостатке кредитов
- Поддержка fallback на альтернативные модели

### Вызов 2: Устойчивость к сбоям в production-среде
**Проблема:** Сетевые ошибки и временная недоступность LLM могут приводить к падению бота

**Решение:**
- Реализован polling с автоматическими повторами при ошибках
- Добавлен механизм `_safe_answer` с повторной попыткой отправки сообщений
- Graceful handling исключений на всех уровнях (polling, LLM-запросы, отправка сообщений)

### Вызов 3: Баланс между simplicity и функциональностью
**Проблема:** Необходимо сделать минимальный, но работающий прототип

**Решение:**
- Следование принципу YAGNI (You Aren't Gonna Need It)
- Минимальная архитектура: 3 основных модуля (main, config, llm_client)
- Использование только необходимых зависимостей
- Простая структура проекта без избыточных абстракций

### Вызов 4: Конфигурирование без хардкода
**Проблема:** Безопасное хранение токенов и гибкая настройка параметров

**Решение:**
- Использование TOML-конфигурации для читаемости
- Поддержка переменных окружения как приоритетного источника
- Fallback на hardcoded значения для быстрого запуска (в dev-режиме)

## Что узнал нового в процессе AI-driven разработки

1. **Итеративность как основной принцип** — AI-driven разработка наиболее эффективна при разбиении задачи на маленькие итерации с быстрым прототипированием и проверкой каждой части

2. **Важность границ и контекста для LLM** — чёткая формулировка роли и ограничения через системный промпт критически важны для получения релевантных ответов от LLM

3. **Fallback-стратегии обязательны** — при работе с внешними LLM-сервисами необходимо предусматривать множественные модели и механизмы переключения, так как бесплатные модели могут быть временно недоступны

4. **Simplicity побеждает complexity** — в AI-driven разработке избыточная архитектура не только усложняет поддержку, но и затрудняет AI-ассистенту понимание кодовой базы. Минималистичная структура эффективнее

5. **Интеграция с существующими инструментами** — использование OpenRouter позволяет легко экспериментировать с различными моделями без привязки к одному провайдеру, что ускоряет разработку и тестирование

## Опционально: Ссылка на работающего бота

Бот доступен в Telegram: **@Testbot_forAI**

---

**Дата создания отчёта:** Октябрь 2025  
**Статус проекта:** MVP полностью реализован, все основные этапы выполнены
